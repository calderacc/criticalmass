<!DOCTYPE html>
<html lang="de">
<head>
    <title>criticalmass.in</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <script>
        var isPageLoaded = false;
        var citySlug = '{{ citySlug }}';

        window.onload = function()
        {
            function loadingCompletedCallback()
            {
                if (CityFactory.hasCities() && RideFactory.hasRides() && !isPageLoaded)
                {
                    PageDispatcher.registerPageSwitchCallback();
                    PageDispatcher.handleCurrentPage();

                    isPageLoaded = true;

                    var globalPage = new GlobalPage();

                    globalPage.initPage();
                }
            }

            $(function() { $( "body>[data-role='panel']" ).panel().enhanceWithin(); });

            CityFactory.refreshAllStoredCities(loadingCompletedCallback);
            RideFactory.refreshAllStoredRides(loadingCompletedCallback);
        };

    </script>
    {% stylesheets '@CalderaCriticalmassMobileBundle/Resources/public/css/*.css' filter="cssrewrite" %}
    <link rel="stylesheet" href="{{ asset_url }}" type="text/css" />
    {% endstylesheets %}
    {% javascripts '@CalderaCriticalmassMobileBundle/Resources/public/js/external/*'
                   '@CalderaCriticalmassMobileBundle/Resources/public/js/factories/*'
                   '@CalderaCriticalmassMobileBundle/Resources/public/js/pages/*'
                   '@CalderaCriticalmassMobileBundle/Resources/public/js/entities/*'
                   '@CalderaCriticalmassMobileBundle/Resources/public/js/map/*'
                   '@CalderaCriticalmassMobileBundle/Resources/public/js/*' %}
    <script type="text/javascript" src="{{ asset_url }}"></script>
    {% endjavascripts %}
</head>
<body id="webapp">
<!-- Menü -->
<section data-role="panel" id="mainpanel" data-position="left" data-qa-ta="mainpanel">
    <ul data-role="listview" data-theme="a">
        <li data-icon="delete"><a href="#" data-rel="close" data-qa-ta="mobile-mainpanel-close">Menü schließen</a></li>
            <li><a href="#startPage" data-qa-ta="mobile-mainpanel-startpage">Startseite</a></li>
            <li data-role="list-divider" data-qa-ta="mainpanel-city-title" class="city-full-title"></li>
            <li><a href="#mapPage" data-qa-ta="mobile-mainpanel-mapPage">Karte</a></li>
            <li><a href="#commentPage" data-qa-ta="mobile-mainpanel-commentPage">Kommentare</a></li>
        <li data-role="list-divider" data-qa-ta="mainpanel-city-title">criticalmass.in</li>
            <li><a id="tokenButton" class="show-loggedin-only" href="#tokenPage" data-qa-ta="mobile-mainpanel-token">Ping</a></li>
            <li><a id="profileButton" class="show-loggedin-only" style="display: none;" href="#colorPage" data-qa-ta="mobile-mainpanel-color">Farbe wählen</a></li>
            <li><a id="logoutButton" class="show-loggedin-only" style="display: none;" href="#" data-ajax="false" data-qa-ta="mobile-mainpanel-logout">Logout</a></li>
            <li><a id="registerButton" class="show-loggedout-only" style="display: none;" href="#registerPage" data-qa-ta="mobile-mainpanel-register">Registrierung</a></li>
            <li><a id="loginButton" class="show-loggedout-only" style="display: none;" href="#loginPage" data-qa-ta="mobile-mainpanel-login">Login</a></li>
        <li><a href="#impressPage" data-qa-ta="mobile-mainpanel-impress">Impressum</a></li>
    </ul>
</section>

<!-- Karte -->
<section data-role="page" id="mapPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1 class="city-short-title"></h1>
    </header>
    <section data-role="content" id="mapPageContent">
        <div id="map"></div>

        <div id="map-control-panel" data-role="collapsible-set">
            <div data-role="collapsible" id="quickLinks">
                <h3 data-qa-ta="mobile-map-statistic">Schnellzugriff</h3>

                <button id="quicklinkOwnPosition" disabled="true">Zur eigenen Position</button>
                <button id="quicklinkLocation">Zum Treffpunkt</button>
                <button id="quicklinkLatestPosition" disabled="true">Zur neusten Position</button>
            </div>
            <div data-role="collapsible">
                <h3 data-qa-ta="mobile-map-statistic">Statistik</h3>
                <p class="lastmodified">zuletzt aktualisiert: <span id="datetime" data-qa-ta="mobile-map-datetime">nie</span></p>
                <p class="usercounter">Einberechnete Benutzer: <span id="usercounter" data-qa-ta="mobile-map-usercounter">0</span></p>
                <p class="averagespeed">Durchschnittsgeschwindigkeit: <span id="averagespeed" data-qa-ta="mobile-map-averagespeed">0</span> Kilometer pro Stunde</p>
                <p class="gpsquality">GPS-Qualität: <span id="gpsquality" data-qa-ta="mobile-map-gpsquality">unbekannt</span></p>
            </div>
        </div>
    </section>
</section>

<!-- Startseite -->
<section data-role="page" id="startPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Critical Mass</h1>
    </header>
    <section data-role="content" id="startPageContent">
        <h2>„Hej! We are traffic!“</h2>
        <p>Überall auf der Welt treffen sich tausende Radfahrer an einem ganz besonderen Tag im Monat zu einer gemeinsamen Radtour. Wähle deine Stadt und sei dabei!</p>

        <ul id="cityList" data-role="listview">

        </ul>

    </section>
</section>

<!-- Farben-Seite -->
<section data-role="page" id="colorPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Deine Lieblingsfarbe</h1>
    </header>
    <section data-role="content" id="colorPageContent">
        <h2>Wähle deine Farbe</h2>

        <p>Konfiguriere hier die Farbe, mit der deine Position für andere Teilnehmer auf der Karte angezeigt wird: <div id="colorExample"></div></p>

        <input type="range" name="slider-usercolor-red" id="slider-usercolor-red" value="0" min="0" max="255" data-qa-ta="mobile-usercolor-red"/>
        <input type="range" name="slider-usercolor-green" id="slider-usercolor-green" value="0" min="0" max="255" data-qa-ta="mobile-usercolor-green"/>
        <input type="range" name="slider-usercolor-blue" id="slider-usercolor-blue" value="0" min="0" max="255" data-qa-ta="mobile-usercolor-blue"/>

        <button id="randomColorButton">Ich kann mich nicht entscheiden!</button>
    </section>
</section>

<!-- Kommentar-Seite -->
<section data-role="page" id="commentPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Kommentare</h1>
    </header>
    <section data-role="content" id="commentPageContent">
        <form id="writeCommentForm" style="display: none;" class="show-loggedin-only">
            <label for="commentText">Schreib etwas:</label>
            <textarea name="commentText" id="commentText"></textarea>
            <button id="submitCommentButton">Abschicken</button>
        </form>

        <ul id="commentList" data-role="listview">

        </ul>
    </section>
</section>

<!-- Impressum -->
<section data-role="page" id="impressPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Impressum</h1>
    </header>
    <section class="menu"></section>
    <section data-role="content" id="impressPageContent">
        <h2>Impressum</h2>

        <p>Angaben nach § 5 TMG:</p>
        <p>Malte Hübner<br />Fritz-Reuter-Straße 57<br />24782 Büdelsdorf</p>
        <p><a href="mailto:malte@criticalmass.in">malte@criticalmass.in</a><br />0700 11 864 833</p>
    </section>
</section>

<!-- Login -->
<div id="loginPageErrorDialog" data-role="page" data-dialog="true">
    <div data-role="header">
        <h2>Login fehlgeschlagen</h2>
    </div>
    <div class="ui-content" role="main">
        <h2>Dein Benutzername oder dein Kennwort waren nicht korrekt</h2>
        <p>Bitte versuche es noch einmal. Wenn du dein Kennwort oder deinen Benutzernamen vergessen haben solltest, musst du leider bis zur Vollversion von criticalmass.in warten, die in einigen Tagen erscheint.</p>
        <div class="ui-grid-a">
            <div class="ui-block-a">
                <a href="#startPage" id="exit-button" class="ui-btn ui-btn-b ui-shadow ui-corner-all">Zurück zur Startseite</a>
            </div>
            <div class="ui-block-b">
                <a href="#loginPage" id="cancel-button" class="ui-btn ui-shadow ui-corner-all">Nächster Versuch</a>
            </div>
        </div>
    </div>
</div>
<section data-role="page" id="loginPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Login</h1>
    </header>
    <section data-role="content" id="loginPageContent">
        <form action="" method="post" id="form-login" class="show-loggedout-only" style="display: none;">
            <label for="username">Dein Benutzername:</label>
            <input type="text" id="username" name="_username" required="required" />

            <label for="password">Dein Kennwort:</label>
            <input type="password" id="password" name="_password" required="required" />

            <input type="checkbox" id="remember_me" name="_remember_me" value="on" />
            <label for="remember_me">Eingeloggt bleiben?</label>

            <input type="submit" id="_submit" name="_submit" value="Aufsatteln!" />
        </form>

        <section class="show-loggedin-only"><h2>Stop!</h2><p>Du bist doch schon eingeloggt.</p></section>
    </section>
</section>

<!-- Informationen -->
<section data-role="page" id="cityPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1 class="city-short-title"></h1>
    </header>
    <section data-role="content" id="cityPageContent">
        <h1 class="city-full-title"></h1>

        <section id="cityFullDescription"></section>

        <h2>Mehr dazu im Social Web:</h2>
        <section id="citySocialMediaLinks" class="ui-grid-b">
            <div class="ui-block-a"><button type="button" data-theme="a">facebook</button></div>
            <div class="ui-block-b"><button type="button" data-theme="a">twitter</button></div>
            <div class="ui-block-c"><button type="button" data-theme="a">WWW</button></div>
        </section>

        <h2>Inhalte auf criticalmass.in:</h2>
        <section class="ui-grid-a">
            <div class="ui-block-a"><button type="button" data-theme="a" id="cityRideButton">37 Touren</button></div>
            <div class="ui-block-b"><button type="button" data-theme="a" id="cityHeatmapButton">43 Heatmaps</button></div>
        </section>
    </section>
</section>

<!-- Registrierung -->
<section data-role="page" id="registerPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Registrierung</h1>
    </header>
    <section data-role="content" id="registerPageContent">
        <h2>Registrierung</h2>

        <p>Hier bekommst du dein Benutzerkonto, mit dem du während der Fahrt deine Positionsdaten und Kommentare senden kannst (und in naher Zukunft noch weitere Vorteile hast, aber daran arbeiten wir noch).</p>

        <form action="" method="post" id="form-register" class="show-loggedout-only" style="display: none;">
            <label for="username">Dein Benutzername:</label>
            <span class="errorMessage" id="registrationUsernameError"></span>
            <input type="text" id="username" name="_username" required="required" value="testusername" />

            <label for="password">Dein Kennwort:</label>
            <span class="errorMessage" id="registrationPasswordError"></span>
            <input type="password" id="password" name="_password" required="required" value="123123" />

            <label for="email">Deine E-Mail-Adresse:</label>
            <span class="errorMessage" id="registrationAddressError"></span>
            <input type="email" id="email" name="_email" required="required" value="testusername@caldera.cc" />

            <button id="submitRegistrationButton" name="_submit">Auf geht’s</button>
        </form>
    </section>
</section>

<section data-role="page" id="registerSuccessPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Registrierung</h1>
    </header>
    <section data-role="content" id="registerSuccessPageContent">
        <h2>Registrierung</h2>

        <p>Prima, herzlich willkommen! Wir haben dir eine E-Mail geschickt, die einen Link enthält, um dein Benutzerkonto zu bestätigen. Nachdem du diesen Link angeklickt hast, kannst du dich auf der <a href="#loginPage">Login-Seite</a> anmelden.</p>
    </section>
</section>

<!-- TokenPage -->
<section data-role="page" id="tokenPage">
    <header data-role="header">
        <a class="openmenubutton" href="#mainpanel" data-icon="bars" data-iconpos="notext" data-shadow="false" data-iconshadow="false" data-qa-ta="mobile-mainpanel-open">Menü</a>
        <h1>Ping</h1>
    </header>
    <section data-role="content" id="tokenPageContent">
        <h2>Unsere App: Ping</h2>

        <p>Eine Web-App läuft zwar ohne Installation und superschnell im Browser, hat aber einen großen Nachteil: Sie wird beendet, sobald der Browser geschlossen wird oder das Smartphone in den Ruhezustand wechselt. Um regelmäßig während einer Critical Mass Positionsdaten zu senden, müsste das Smartphone regelmäßig aufgeweckt werden. Unsere Ping-App gibt’s hoffentlich bald für iOS und sammelt auch im Hintergrund deine Positionsdaten. Bitte lade dir Ping herunter und kopiere den folgenden Code in die App:</p>

        <label for="pingToken">Dein Token:</label>
        <input type="text" name="pingToken" id="pingToken" readonly="true" />
    </section>
</section>

<!-- Piwik -->
<script type="text/javascript">
    var _paq = _paq || [];
    _paq.push(["setCookieDomain", "*.www.criticalmass.in"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
        var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.caldera.cc/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', 1]);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0]; g.type='text/javascript';
        g.defer=true; g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
    })();
</script>
<noscript><p><img src="http://piwik.caldera.cc/piwik.php?idsite=1" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->

</body>
</html>
