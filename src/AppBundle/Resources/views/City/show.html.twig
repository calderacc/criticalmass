{% extends 'AppBundle:Template:StandardTemplate.html.twig' %}

{% set bootstrap4 = true %}

{% block breadcrumb %}
    <li><a href="{{ path('caldera_criticalmass_desktop_city_list') }}">Städteliste</a></li>
    <li class="active">{{ city.city }}</li>
{% endblock %}

{% block optionsButton %}
    <div class="btn-group pull-right">
        <button type="button" class="btn btn-success dropdown-toggle" data-toggle="dropdown" aria-haspopup="true"
                aria-expanded="false">
            <i class="fa fa-cogs"></i>
            Optionen
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <li>
                <a href="{{ path('caldera_criticalmass_desktop_city_edit', { citySlug: city.getMainSlugString() } ) }}">
                    <i class="fa fa-cogs"></i>
                    Stadt editieren
                </a>
            </li>

            <li>
                <a href="{{ path('caldera_criticalmass_desktop_ride_add', { citySlug: city.getMainSlugString() } ) }}">
                    <i class="fa fa-plus"></i>
                    Tour hinzufügen
                </a>
            </li>
        </ul>
    </div>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-12">
                {% if city.imageName %}
                    <div class="jumbotron" id="city-jumbotron"
                         style="height: 250px; background-image: url({{ vich_uploader_asset(city, 'imageFile')|imagine_filter('city_image_wide') }});">
                        <div class="row">
                            <div class="col-12">
                                <h1 class="pull-right no-margin-top">
                                    {{ city.title }}
                                </h1>
                            </div>
                        </div>

                        {% if city.punchline %}
                            <div class="row">
                                <div class="col-md-12">
                                    <p class="lead pull-right no-margin-top">
                                        {{ city.punchline }}
                                    </p>
                                </div>
                            </div>
                        {% endif %}

                        {% if app.getUser() %}
                            <div class="row">
                                <div class="col-md-12">
                                    {{ block('optionsButton') }}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                {% else %}
                    {% if app.getUser() %}
                        {{ block('optionsButton') }}
                    {% endif %}
                    <h1 class="no-margin-top">
                        {{ city.title }}
                    </h1>
                {% endif %}
            </div>
        </div>

        <div class="row">
            <div class="col-12 col-md-8">
                <div class="row">
                    <div class="col-12">
                        {% if city.longDescription %}
                        {{ city.longDescription|markdown }}
                        {% else %}
                        <div class="alert alert-info">
                            <strong>Huch?</strong>
                            Schade, bislang hat noch niemand Informationen über {{ city.city }} hinterlegt. Wenn du Lust und Zeit hast, kannst du {{ city.title }} <a href="{{ path('caldera_criticalmass_desktop_city_edit', {citySlug: city.mainSlugString}) }}">hier beschreiben</a>:

                            <ul>
                                <li>
                                    Seit wann gibt es die Critical Mass in {{ city.city }}?
                                </li>
                                <li>
                                    Wie lange dauern eure Touren?
                                </li>
                                <li>
                                    Wo fahrt ihr ungefähr lang?
                                </li>
                                <li>
                                    Welche Probleme gibt es in {{ city.city }} für den Radverkehr?
                                </li>
                            </ul>

                            <p class="text-center margin-top-medium">
                                <a href="{{ path('caldera_criticalmass_desktop_city_edit', {citySlug: city.mainSlugString}) }}" class="btn btn-primary btn-lg">
                                    {{ city.city }} editieren
                                </a>
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>

                {% for ride in rides %}
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-3">
                                {% if ride.featuredPhoto %}
                                <img class="card-img-top" src="{{ vich_uploader_asset(ride.featuredPhoto, 'imageFile')|imagine_filter('ride_image_wide') }}" alt="{{ ride.title }}" />
                                {% endif %}
                                <div class="card-body">
                                    <h4 class="card-title">
                                        {{ ride.fancyTitle }}
                                    </h4>
                                    {% if ride.description %}
                                    <p class="card-text">
                                        {{ ride.description }}
                                    </p>
                                    {% endif %}
                                    <p class="card-text">
                                        <small class="text-muted">
                                            {{ ride.dateTime|format_datetime(null, 'de', 'Europe/Berlin', constant('IntlDateFormatter::LONG'), constant('IntlDateFormatter::SHORT')) }}&nbsp;Uhr{% if ride.hasLocation() and ride.location %}, {{ ride.location }}{% endif %}
                                        </small>
                                    </p>
                                </div>
                            </div>

                        </div>
                    </div>
                {% endfor %}

                <div class="row">
                    <div class="col-12 text-center">
                        <a href="{{ path('caldera_criticalmass_desktop_city_listrides', { citySlug: city.getMainSlugString }) }}"
                           class="btn btn-primary">
                            <i class="fa fa-list"></i>
                            weitere Touren anzeigen
                        </a>
                    </div>
                </div>

                {% if photos|length > 0 %}
                    <div class="row">
                        <div class="col-md-12">
                            <h2>
                                Fotos aus {{ city.city }}
                            </h2>

                            <p>
                                Hier siehst du ein paar Fotos aus {{ city.city }}. Schau dir auch die <a
                                        href="{{ path('caldera_criticalmass_desktop_city_listgalleries', { 'citySlug': city.slug }) }}">Übersicht
                                    über Fotos aus {{ city.city }}</a> an.
                            </p>
                        </div>
                    </div>

                    <div class="row">
                        <div class="photo-list">
                            {% for photo in photos %}
                                <div class="col-xs-6 col-sm-4 col-md-3 col-lg-3">
                                    <div class="photo-thumb margin-bottom-medium text-center">
                                        <a href="{{ objectPath(photo) }}">
                                            <img class="img-responsive"
                                                 src="{{ vich_uploader_asset(photo, 'imageFile')|imagine_filter('gallery_photo_thumb') }}"/>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                {% endif %}
            </div>

            <div class="col-12 col-md-4">
                <div class="row">
                    <div class="col-12">
                        {% include 'AppBundle:City:Includes/_live.html.twig' with { 'city': city } %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        {% include 'AppBundle:City:Includes/_nextTour.html.twig' with { 'city': city, 'currentRide': currentRide } %}
                    </div>
                </div>

                {% if 'Hamburg' in city.city %}
                <div class="row">
                    <div class="col-12" id="fahrradstadthamburg-container">
                        <script>
                            CriticalMass.loadModule('FahrradstadtHamburg', '#fahrradstadthamburg-container');
                        </script>
                    </div>
                </div>
                {% endif %}

                <div class="row">
                    <div class="col-12">
                        {% include 'AppBundle:City:Includes/_statistic.html.twig' with { 'city': city } %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        {% include 'AppBundle:City:Includes/_socialMedia.html.twig' with { 'city': city } %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        {% include 'AppBundle:City:Includes/_locations.html.twig' with { 'city': city, 'locations': locations } %}
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        {% include 'AppBundle:City:Includes/_nearCities.html.twig' with { 'nearCities': nearCities } %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
