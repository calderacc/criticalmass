{% extends 'Template/StandardTemplate.html.twig' %}{% import 'Bootstrap/bootstrap_macros.html.twig' as bootstrap %}

{% block title %}Deine Tracks{% endblock %}

{% block breadcrumb %}
    <li>
        <a href="{{ path('criticalmass_user_usermanagement') }}">
            Dein Benutzerkonto
        </a>
    </li>

    <li class="active">
        Deine Tracks
    </li>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-12">
                <h2>
                    Deine Gpx-Tracks
                </h2>

                <p class="lead">
                    Hier siehst du alle Tracks, die du bei deinen bisherigen Critical-Mass-Teilnahmen aufgezeichnet hast.
                </p>

                <p>
                    Klicke in der Übersicht einer Radtour im Reiter „Tracks“ auf den grünen Button, um einen neuen Track hinzuzufügen.
                </p>
            </div>
        </div>

        <div class="row">
            {% for track in pagination %}
                <div class="col-4 mb-2">
                    <div class="card panel-default{% if not track.enabled %} panel-danger{% endif %}">
                        <div class="card-header">
                            <a href="{{ objectPath(track.ride) }}">
                                {{ track.ride.title }}
                            </a>
                        </div>
                        <div class="card-body">
                            <div class="row mb-2">
                                <div class="col-12">
                                    <div id="map-{{ track.id }}" class="preview-map" style="height: 150px;" data-polyline-color="rgb({{ track.colorRed }}, {{ track.colorGreen }}, {{ track.colorBlue }})" data-lock-map="true" data-polyline="{{ track.polyline }}"></div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-6">
                                    <dl>
                                        <dt>
                                            Stadt
                                        </dt>

                                        <dd>
                                            <a href="{{ objectPath(track.ride.city) }}">
                                                {{ track.ride.city.city }}
                                            </a>
                                        </dd>
                                    </dl>
                                </div>

                                <div class="col-6">
                                    <dl>
                                        <dt>
                                            Datum
                                        </dt>

                                        <dd>
                                            <a href="{{ objectPath(track) }}">
                                                {{ track.ride.dateTime|date('d.m.Y') }}
                                            </a>
                                        </dd>
                                    </dl>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-4">
                                    <dl>
                                        <dt>
                                            Länge
                                        </dt>

                                        <dd>
                                            {{ track.distance|round }}&nbsp;km
                                        </dd>
                                    </dl>
                                </div>

                                <div class="col-4">
                                    <dl>
                                        <dt>
                                            Beginn
                                        </dt>

                                        <dd>
                                            {{ track.startDateTime|date('H:i', track.ride.city.timezone) }}&nbsp;Uhr
                                        </dd>
                                    </dl>
                                </div>

                                <div class="col-4">
                                    <dl>
                                        <dt>
                                            Ende
                                        </dt>

                                        <dd>
                                            {{ track.endDateTime|date('H:i', track.ride.city.timezone) }}&nbsp;Uhr
                                        </dd>
                                    </dl>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-12">
                                    <div class="btn-group pull-right">
                                        {% set dropdown_list = [
                                            { href: objectPath(track, 'caldera_criticalmass_track_download'), caption: '<i class="fa fa-file"></i> Herunterladen' },
                                            { href: objectPath(track, 'caldera_criticalmass_track_range'), caption: '<i class="fa fa-scissors"></i> Beschneiden' },
                                            { href: objectPath(track, 'caldera_criticalmass_track_time'), caption: '<i class="fa fa-clock-o"></i> Zeit anpassen' },
                                            { href: '#', attr: { class: 'delete-track',  'data-track-id': track.id }, caption: '<i class="fa fa-trash"></i> Löschen' },
                                        ] %}

                                        {% if track.enabled %}
                                            {% set dropdown_list = dropdown_list | merge([{ href: objectPath(track, 'caldera_criticalmass_track_toggle'), caption: '<i class="fa fa-eye-slash"></i> Deaktivieren' }]) %}
                                        {% else %}
                                            {% set dropdown_list = dropdown_list | merge([{ href: objectPath(track, 'caldera_criticalmass_track_toggle'), caption: '<i class="fa fa-eye"></i> Aktivieren' }]) %}
                                        {% endif %}

                                        {{ bootstrap.dropdown('Bearbeiten', dropdown_list, 'btn-outline-secondary btn-sm', false) }}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            {{ knp_pagination_render(pagination, null, [], { align: 'center' } ) }}
        </div>
    </div>

    <script>
        CriticalMass.loadModule('TrackListPage');
    </script>
{% endblock %}
